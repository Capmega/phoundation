#!/usr/bin/php
<?php
use Phoundation\Cli\Color;
use Phoundation\Cli\Scripts;
use Phoundation\Core\Config;
use Phoundation\Core\Core;
use Phoundation\Core\Log;
use Phoundation\Core\Strings;
use Phoundation\Databases\Sql\Sql;
use Phoundation\Developer\Debug;
use Phoundation\Exception\ScriptException;
use Phoundation\Processes\Commands;
use Phoundation\Processes\FilesystemCommands;
use Phoundation\Processes\ProcessCommands;
use Phoundation\Processes\Processes;
use Phoundation\Processes\Workers;



/**
 * Script system/test
 *
 * This is a test script where we can test various new systems
 *
 * @author Sven Olaf Oostenbrink <so.oostenbrink@gmail.com>
 * @license http://opensource.org/licenses/GPL-2.0 GNU Public License, Version 2
 * @copyright Copyright (c) 2022 Sven Olaf Oostenbrink <so.oostenbrink@gmail.com>
 * @package Phoundation\System
 */
$usage = './cli system info';

$help  = 'The info script will show detailed information about the current framework, project, database and more';

Scripts::noArgumentsLeft($argv);

FilesystemCommands::local()->which('chmod');
FilesystemCommands::local()->chmod(ROOT . 'README.md', 0o440);
FilesystemCommands::local()->mkdir(ROOT . 'a/b/c/d/e', 0770,true);
FilesystemCommands::local()->mkdir(ROOT . 'a/b/c/d/e', 0770,true);
file_put_contents(ROOT . 'a/b/c/d/e/f', 'This the first test file');
FilesystemCommands::local()->delete(ROOT . 'a/b/e');
FilesystemCommands::local()->delete(ROOT . 'a/b/c', true, true);


//$result = Processes::create('ping')
//    ->addArgument('1.1.1.1')
//    ->setTimeout(1)
//    ->executeBackground();
//
//$result = Processes::create('ping')
//    ->addArgument('8.8.8.8')
//    ->setTimeout(1)
//    ->executeBackground();


Workers::create('ping')
    ->addArgument('$server$')
    ->setTimeout(10)
    ->setKey('$server$')
    ->setWaitWorkerFinish(true)
    ->setValues([
        '1.1.1.1',
        '8.8.8.8',
        'google.com',
        'reddit.com',
        'cnn.com',
        '1.1.1.1',
        '8.8.8.8',
        'google.com',
        'reddit.com',
        'cnn.com',
        'reddit.com',
        'cnn.com'
    ])->start();

