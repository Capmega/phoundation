#!/usr/bin/php
<?php
/*
 * This script creates sitemap files for all languages
 *
 * Idea taken from http://yoast.com/xml-sitemap-php-script/
 * Written by Sven Oostenbrink
 *
 * Copyright (C), 2011 - 2012 - Sven Oostenbrink, so.oostenbrink@gmail.com
 *
 * Sitemap scanner should honor robots.txt and meta robots noindex!
 * Sitemap scanner should extract descriptions from pages
 */
$usage = "sitemap clear\n".
         "sitemap delete\n".
         "sitemap create\n";

$help  = "This sitemap script can create new sitemap files";

require_once(dirname(__FILE__).'/../../libs/startup.php');

if(empty($_CONFIG['sitemap']['enabled'])){
    cli_log(tr('Sitemap has been disabled in the configuration'), 'yellow');
    cli_die(0);
}

load_libs('sitemap');
right_or_redirect('admin');

switch(cli_method()){
    case 'clear':
        /*
         * Clear sitemap database.
         */
        if(cli_method(1)){
            cli_log(tr('Clearing sitemap data for group ":group"', array(':group' => cli_method(1))), 'white');

        }else{
            cli_log(tr('Clearing sitemap data'), 'white');
        }

        cli_no_arguments_left();
        sitemap_clear(cli_method(1));

        cli_log(tr('Sitemap data has been cleared'), 'green');

        break;

    case 'generate':
        cli_no_arguments_left();
        cli_log(tr('Regenerating sitemap files'), 'white');
        sitemap_generate();
        log_error('Done!', 'finished', 'green');
        break;

    case '':
        throw new bException(tr('No argument specified'), 'unknown');

    default:
        throw new bException(tr('Unknown argument ":method" specified', array(':method' => cli_method())), 'unknown');
}
?>
